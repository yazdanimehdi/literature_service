{{- if .Values.externalSecrets.enabled }}
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: {{ include "literature-review-service.fullname" . }}
  labels:
    {{- include "literature-review-service.labels" . | nindent 4 }}
spec:
  refreshInterval: {{ .Values.externalSecrets.refreshInterval }}
  secretStoreRef:
    name: {{ .Values.externalSecrets.secretStoreRef.name }}
    kind: {{ .Values.externalSecrets.secretStoreRef.kind }}
  target:
    name: {{ .Values.externalSecrets.target.name | default (printf "%s-secrets" (include "literature-review-service.fullname" .)) }}
    creationPolicy: {{ .Values.externalSecrets.target.creationPolicy }}
  data:
    - secretKey: DATABASE_USER
      remoteRef:
        key: helixir/literature-review-service/database
        property: user
    - secretKey: DATABASE_PASSWORD
      remoteRef:
        key: helixir/literature-review-service/database
        property: password
    - secretKey: TEMPORAL_HOST_PORT
      remoteRef:
        key: helixir/literature-review-service/temporal
        property: host_port
    - secretKey: KAFKA_BROKERS
      remoteRef:
        key: helixir/literature-review-service/kafka
        property: brokers
    - secretKey: LLM_OPENAI_API_KEY
      remoteRef:
        key: helixir/literature-review-service/llm
        property: openai_api_key
    - secretKey: LLM_ANTHROPIC_API_KEY
      remoteRef:
        key: helixir/literature-review-service/llm
        property: anthropic_api_key
{{- end }}
